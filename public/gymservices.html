<!DOCTYPE html>
<html>

<head>
    <title>B-Hub</title>
    <meta name="viewport" content="width=device-width,  initial-scale=1.0">
    <link rel="stylesheet" href="css/bhub.css" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-firestore.js"></script>
</head>

<body>
    <div id="splash">
        <img style="filter: blur(7px); -webkit-filter: blur(7px);" src="images/b_hub_logo.png" />
    </div>
    <div
        style="width: 100%; height: 100%; position: fixed; background-image: linear-gradient(to bottom, #000000cc, black);">
    </div>
    <div style="width: 100%; overflow: hidden; overflow-y: scroll;">
        <h2
            style="position: relative; color: white; top: 60px; margin-left: 20px; margin-right: 47px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 24px;">
            Services you offer</h2>
        <p
            style="position: relative; margin-top: 80px; margin-left: 20px; margin-right: 50px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 15px; color: white;">
            Create your account to help us publish your business to customer, registration is free</p>
        <fieldset
            style="position: relative; margin-top: 30px; color: white; border-radius: 5px; margin-left: 20px; margin-right: 20px; font-size: 18px;">
            <legend>Select service category*</legend>

            <div style="margin-top: 10px;">
                <input type="radio" id="body-hair" name="service" value="yoga" />
                <label for="body-hair">&nbsp;&nbsp;Yoga</label>
            </div>

            <div style="margin-top: 20px;">
                <input type="radio" id="beard" name="service" value="spin" />
                <label for="beard">&nbsp;&nbsp;Spin</label>
            </div>

            <div style="margin-top: 20px;">
                <input type="radio" id="hands-feet" name="service" value="zumba" />
                <label for="hands-feet">&nbsp;&nbsp;Zumba</label>
            </div>
            <div style="margin-top: 20px;">
                <input type="radio" id="hair" name="service" value="circuit training" />
                <label for="hair">&nbsp;&nbsp;Circuit Training</label>
            </div>

            <div style="margin-top: 20px; margin-bottom: 10px;">
                <input type="radio" id="face" name="service" value="mx4" />
                <label for="face">&nbsp;&nbsp;MX4</label>
            </div>

            <div style="margin-top: 20px; margin-bottom: 10px;">
                <input type="radio" id="other" name="service" value="other" />
                <label for="other">&nbsp;&nbsp;Other</label>
            </div>
        </fieldset>

        <div id="service-holder">
            <p id="svc-tool-tip">
                Your popular services*
            </p>
            <div
                style="position: relative;  margin-top: 10px; margin-left: 20px; align-items: start; justify-content: left; display: flex; margin-right: 20px;">
                <input type="text" placeholder="Service name here ..." required id="input-svc-name" />
            </div>
            <div
                style="position: relative;  margin-top: 10px; margin-left: 20px; align-items: start; justify-content: left; display: flex; margin-right: 20px;">
                <input type="text" placeholder="Service period here eg. 20min ..." required id="input-svc-period" />
            </div>
            <div
                style="position: relative;  margin-top: 10px; margin-left: 20px; align-items: start; justify-content: left; display: flex; margin-right: 20px;">
                <input type="number" placeholder="Service fee here eg. 50000 ..." required id="input-svc-price" />
            </div>
            <div
                style="position: relative;  margin-top: 10px; margin-left: 20px; align-items: start; justify-content: left; display: flex; margin-right: 20px;">
                <input type="text" placeholder="Offer here eg. save 10% (optional) ..." required id="input-svc-offer" />
            </div>
            <input type="button" id="save-pop-svc-btn" value="SAVE SERVICE" />
            <p id="full-menu-tool-tip">
                Your full menu of services*
            </p>
            <div
                style="position: relative;  margin-top: 10px; margin-left: 20px; align-items: start; justify-content: left; display: flex; margin-right: 20px;">
                <input type="text" placeholder="Service name here ..." required id="input-full-menu-name" />
            </div>
            <div
                style="position: relative;  margin-top: 10px; margin-left: 20px; align-items: start; justify-content: left; display: flex; margin-right: 20px;">
                <input type="text" placeholder="Service period here eg. 20min ..." required
                    id="input-full-menu-period" />
            </div>
            <div
                style="position: relative;  margin-top: 10px; margin-left: 20px; align-items: start; justify-content: left; display: flex; margin-right: 20px;">
                <input type="number" placeholder="Service fee here eg. 50000 ..." required id="input-full-menu-price" />
            </div>
            <input type="button" id="save-full-menu-btn" value="SAVE SERVICE" />
            <div style="width: 100%; height: 100px; position: relative;"></div>
        </div>

        <div id="product-holder">
            <p id="svc-tool-tip">
                Other products*
            </p>
            <div
                style="position: relative;  margin-top: 20px; margin-left: 20px; align-items: start; justify-content: left; display: flex; margin-right: 20px;">
                <input type="text" placeholder="Product name here ..." required id="input-prod-name" />
            </div>
            <div
                style="height: 300px; position: relative; border: 1px solid darkgrey; border-radius: 6px; margin-top: 20px; margin-left: 20px; margin-right: 20px; align-items: center; justify-content: center; display: flex;">
                <img id="product-image" src="images/b_hub_logo.png" />
            </div>
            <input type="file" id="input-img-url" />
            <input type="button" id="upload-img-btn" value="UPLOAD IMAGE" />

            <div
                style="position: relative;  margin-top: 20px; margin-left: 20px; align-items: start; justify-content: left; display: flex; margin-right: 20px;">
                <input type="text" placeholder="Quantity eg. 100ml ..." required id="input-prod-qty" />
            </div>

            <div
                style="position: relative;  margin-top: 20px; margin-left: 20px; align-items: start; justify-content: left; display: flex; margin-right: 20px;">
                <input type="number" placeholder="Product price here eg. 50000 ..." required id="input-prod-price" />
            </div>
            <div
                style="position: relative;  margin-top: 10px; margin-left: 20px; align-items: start; justify-content: left; display: flex; margin-right: 20px;">
                <input type="text" placeholder="Product description here ..." required id="input-prod-desc" />
            </div>
            <div
                style="position: relative;  margin-top: 10px; margin-left: 20px; align-items: start; justify-content: left; display: flex; margin-right: 20px;">
                <input type="text" placeholder="Offer here eg. save 10% (optional) ..." required id="input-prod-disc" />
            </div>
            <input type="button" id="save-prod-btn" value="SAVE PRODUCT" />
            <div style="width: 100%; height: 100px; position: relative;"></div>
        </div>
    </div>
    <div style="position: fixed;  bottom: 10px; left: 20px; right: 20px;">
        <button id="skip-svc-btn" style="border: none; outline: none;">GO</button>
    </div>
    <div style="width: 100%; height: 60px; background-color: black; position: fixed; top: 0%;">
        <span id="close-window-btn" class="material-symbols-outlined">arrow_back</span>
    </div>
    <dialog id="alert-dialog">
        <div style="height: 100%;">
            <li style="position: relative; list-style-type: none; font-size: 17px; font-weight: 700;">Alert!</li>
            <li id="dlg-text">Gym services are required!</li>
            <div style="position: relative; margin-top: 20px; align-items: end; justify-content: end; display: flex;">
                <li id="dialog-yes-btn" onclick="closeDlg()">OK</li>
            </div>
        </div>
    </dialog>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="js/index.js"></script>
    <script>
        let userId = "";
        let numOfSvc = 0;
        let bodyHair = "";
        let beard = "";
        let handsFeet = "";
        let hair = "";
        let faceCare = "";
        let massage = "";
        let category = "";
        let dlgText = document.getElementById('dlg-text');
        let alertDlg = document.getElementById('alert-dialog');
        let db = firebase.firestore();

        firebase.auth().onAuthStateChanged(function (user) {
            if(user) {
                userId = user.uid;
            }
        });

        $('#upload-img-btn').click(function () {
            var prodName = document.getElementById('input-prod-name').value;
            if (prodName == "") {
                var message = "Product name is required!";
                document.getElementById('dlg-text').innerHTML = message;
                alertDlg.showModal();
                return;
            }
            $('#input-img-url').trigger('click');
        });

        $("#input-img-url").on("change", function (event) {
            if (!(/\.(png|jpg|jpeg)$/i).test(event.target.files[0].name)) {
                window.alert('File not suppoted, upload png, jpg or jpeg files only!');
                return;
            }
            var prodName = document.getElementById('input-prod-name').value;
            selectedImgUri = event.target.files[0];
            let fileName = selectedImgUri.name;
            firebase.auth().onAuthStateChanged(function (user) {
                var userId = user.uid;
                let storageRef = firebase.storage().ref("BHub/" + "Products/" + prodName + fileName);
                let uploadTask = storageRef.put(selectedImgUri);
                uploadTask.on("state_changed", (snapshot) => {
                    console.log(snapshot);
                    percentageVal = Math.floor((snapshot.bytesTransferred / snapshot.totalBytes) * 100);
                    console.log(percentageVal);
                    console.log(userId);
                }, (error) => {
                    console.log("Error is: " + error.message);
                }, () => {
                    uploadTask.snapshot.ref.getDownloadURL().then((url) => {
                        console.log("ImageLink: " + url);
                        imgdownloadUrl = url;
                        var map = {
                            poster: imgdownloadUrl,
                            name: prodName,
                            userID: userId
                        }
                        db.collection("BHub").doc(userId).collection("Products").doc(prodName).set(map).then(function (e) {
                            document.getElementById('product-image').src = url;
                        });
                    });
                });
            });
        });

        // popular service
        document.getElementById('save-pop-svc-btn').addEventListener('click', (e) => {
            let prodName = document.getElementById('input-svc-name').value;
            let prodPrice = document.getElementById('input-svc-price').value;
            let prodDesc = document.getElementById('input-svc-period').value;
            let svcOffer = document.getElementById('input-svc-offer').value;

            if (prodName == "" || prodPrice == "" || prodDesc == "") {
                var message = "Fill all required fields";
                dlgText.innerHTML = message;
                alertDlg.showModal();
                return;
            }

            var map = {
                category: category,
                price: prodPrice,
                period: prodDesc,
                name: prodName,
                offer: svcOffer,
                userID: userId
            }
            db.collection("BHub").doc(userId).collection("Popular Services").doc(prodName).set(map).then(function (e) {
                if (category == "Yoga") {
                    var map = {
                        "yoga": category
                    }
                    db.collection("BHub").doc(userId).update(map).then((c) => {
                        var message = "Service saved successfully";
                        dlgText.innerHTML = message;
                        alertDlg.showModal();
                    });
                } else if (category == "Spin") {
                    var map = {
                        "spin": category
                    }
                    db.collection("BHub").doc(userId).update(map).then((c) => {
                        var message = "Service saved successfully";
                        dlgText.innerHTML = message;
                        alertDlg.showModal();
                    });
                } else if (category == "Zumba") {
                    var map = {
                        "zumba": category
                    }
                    db.collection("BHub").doc(userId).update(map).then((c) => {
                        var message = "Service saved successfully";
                        dlgText.innerHTML = message;
                        alertDlg.showModal();
                    });
                } else if (category == "Circuit Training") {
                    var map = {
                        "circuit": category
                    }
                    db.collection("BHub").doc(userId).update(map).then((c) => {
                        var message = "Service saved successfully";
                        dlgText.innerHTML = message;
                        alertDlg.showModal();
                    });
                } else if (category == "MX4") {
                    var map = {
                        "mx4": category
                    }
                    db.collection("BHub").doc(userId).update(map).then((c) => {
                        var message = "Service saved successfully";
                        dlgText.innerHTML = message;
                        alertDlg.showModal();
                    });
                }
            });
        });

        // full menu
        document.getElementById('save-full-menu-btn').addEventListener('click', (e) => {
            let prodName = document.getElementById('input-full-menu-name').value;
            let prodPrice = document.getElementById('input-full-menu-price').value;
            let prodDesc = document.getElementById('input-full-menu-period').value;

            if (prodName == "" || prodPrice == "" || prodDesc == "") {
                var message = "Fill all required fields";
                dlgText.innerHTML = message;
                alertDlg.showModal();
                return;
            }

            var map = {
                category: category,
                price: prodPrice,
                period: prodDesc,
                name: prodName,
                userID: userId
            }
            db.collection("BHub").doc(userId).collection("Full Menu Services").doc(prodName).set(map).then(function (e) {
                if (category == "Yoga") {
                    var map = {
                        "yoga": category
                    }
                    db.collection("BHub").doc(userId).update(map).then((c) => {
                        var message = "Service saved successfully";
                        dlgText.innerHTML = message;
                        alertDlg.showModal();
                    });
                } else if (category == "Spin") {
                    var map = {
                        "spin": category
                    }
                    db.collection("BHub").doc(userId).update(map).then((c) => {
                        var message = "Service saved successfully";
                        dlgText.innerHTML = message;
                        alertDlg.showModal();
                    });
                } else if (category == "Zumba") {
                    var map = {
                        "zumba": category
                    }
                    db.collection("BHub").doc(userId).update(map).then((c) => {
                        var message = "Service saved successfully";
                        dlgText.innerHTML = message;
                        alertDlg.showModal();
                    });
                } else if (category == "Circuit Training") {
                    var map = {
                        "circuit": category
                    }
                    db.collection("BHub").doc(userId).update(map).then((c) => {
                        var message = "Service saved successfully";
                        dlgText.innerHTML = message;
                        alertDlg.showModal();
                    });
                } else if (category == "MX4") {
                    var map = {
                        "mx4": category
                    }
                    db.collection("BHub").doc(userId).update(map).then((c) => {
                        var message = "Service saved successfully";
                        dlgText.innerHTML = message;
                        alertDlg.showModal();
                    });
                }
            });
        });

        // product
        document.getElementById('save-prod-btn').addEventListener('click', (e) => {
            let prodName = document.getElementById('input-prod-name').value;
            let prodPrice = document.getElementById('input-prod-price').value;
            let prodDesc = document.getElementById('input-prod-desc').value;
            let prodOffer = document.getElementById('input-prod-disc').value;
            let qty = document.getElementById('input-prod-qty').value;

            if (prodName == "" || imgdownloadUrl == "" || prodPrice == "" || prodDesc == "") {
                var message = "Fill all required fields";
                dlgText.innerHTML = message;
                alertDlg.showModal();
                return;
            }

            var map = {
                price: prodPrice,
                desc: prodDesc,
                offer: prodOffer,
                qty: qty
            }
            db.collection("BHub").doc(userId).collection("Products").doc(prodName).update(map).then(function (e) {
                var message = "Product saved successfully";
                dlgText.innerHTML = message;
                alertDlg.showModal();
            });
        });

        document.getElementById('body-hair').addEventListener('change', function () {
            if (this.checked) {
                numOfSvc++;
                category = "Yoga";
                document.getElementById('product-holder').style.display = "none";
                document.getElementById('service-holder').style.display = "block";
                document.getElementById('svc-tool-tip').innerHTML = `Your popular ${category} services*`;
                document.getElementById('full-menu-tool-tip').innerHTML = `${category} full menu*`;
                
            }
        });

        document.getElementById('beard').addEventListener('change', function () {
            if (this.checked) {
                numOfSvc++;
                category = "Spin";
                document.getElementById('product-holder').style.display = "none";
                document.getElementById('service-holder').style.display = "block";
                document.getElementById('svc-tool-tip').innerHTML = `Your popular ${category} services*`;
                document.getElementById('full-menu-tool-tip').innerHTML = `${category} full menu*`;
                
            }
        });

        document.getElementById('hands-feet').addEventListener('change', function () {
            if (this.checked) {
                numOfSvc++;
                category = "Zumba";
                document.getElementById('product-holder').style.display = "none";
                document.getElementById('service-holder').style.display = "block";
                document.getElementById('svc-tool-tip').innerHTML = `Your popular ${category} services*`;
                document.getElementById('full-menu-tool-tip').innerHTML = `${category} full menu*`;
                
            }
        });

        document.getElementById('hair').addEventListener('change', function () {
            if (this.checked) {
                numOfSvc++;
                category = "Circuit Training";
                document.getElementById('product-holder').style.display = "none";
                document.getElementById('service-holder').style.display = "block";
                document.getElementById('svc-tool-tip').innerHTML = `Your popular ${category} services*`;
                document.getElementById('full-menu-tool-tip').innerHTML = `${category} full menu*`;
                
            }
        });

        document.getElementById('face').addEventListener('change', function () {
            if (this.checked) {
                numOfSvc++;
                category = "MX4";
                document.getElementById('product-holder').style.display = "none";
                document.getElementById('service-holder').style.display = "block";
                document.getElementById('svc-tool-tip').innerHTML = `Your popular ${category} services*`;
                document.getElementById('full-menu-tool-tip').innerHTML = `${category} full menu*`;
                
            }
        });

        document.getElementById('other').addEventListener('change', function () {
            if (this.checked) {
                numOfSvc++;
                other = "Other";
                document.getElementById('service-holder').style.display = "none";
                document.getElementById('product-holder').style.display = "block";
                
            }
        });

        document.getElementById('skip-svc-btn').addEventListener('click', (e) => {
            window.close();
            window.open("index.html");
        });

        document.getElementById('close-window-btn').addEventListener('click', (e) => {
            window.close();
        });

        function closeDlg() {
            alertDlg.close();
        }

    </script>
</body>

</html>